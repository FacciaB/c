<!DOCTYPE html>
<html lang="it">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>ClasseViva - Valutazioni</title>
Â  Â  <style>
Â  Â  Â  Â  /* RIUTILIZZA I TUOI STILI CSS DAL REGISTRO DI CLASSE */
Â  Â  Â  Â Â 
Â  Â  Â  Â  body { font-family: Arial, sans-serif; margin: 0; padding: 0; background-color: #f7f7f7; color: #333; }
Â  Â  Â  Â  .header { background-color: #d8232a; color: white; padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; }
Â  Â  Â  Â  .header-title { font-size: 1.5em; font-weight: bold; margin-right: 20px; text-decoration: none; color: white; }
Â  Â  Â  Â  .last-access-bar { background-color: #ffcc00; color: white; padding: 5px 20px; font-size: 0.85em; font-weight: bold; text-shadow: 1px 1px 2px rgba(0,0,0,0.1); }
Â  Â  Â  Â  .menu-nav-container { background-color: white; padding: 10px 20px; border-bottom: 1px solid #ddd; }
Â  Â  Â  Â  .menu-nav { display: flex; justify-content: center; gap: 15px; max-width: 1200px; margin: 0 auto; }
Â  Â  Â  Â  .icon-item { text-align: center; font-size: 0.75em; color: #555; cursor: pointer; text-decoration: none; display: block; min-width: 60px; }
Â  Â  Â  Â  .icon-active { font-weight: bold; color: #d8232a; }
Â  Â  Â  Â  .icon-active > div { border-bottom: 3px solid #d8232a; padding-bottom: 2px; }
Â  Â  Â  Â  .content { padding: 20px; max-width: 1200px; margin: 0 auto; }
Â  Â  Â  Â  .main-info { text-align: center; font-size: 1.3em; font-weight: normal; margin: 20px 0; padding: 10px; background-color: #e8e8e8; border-radius: 4px; }
Â  Â  Â  Â  .main-info strong { color: #d8232a; font-weight: bold; }
Â  Â  Â  Â  .class-links a { margin-right: 10px; text-decoration: none; color: #007bff; font-weight: normal; }
Â  Â  Â  Â  .class-links a.active-class { color: #d8232a; font-weight: bold; border-bottom: 2px solid #d8232a; }

Â  Â  Â  Â  /* NUOVI STILI PER VALUTAZIONI */
Â  Â  Â  Â  .valutazioni-container { display: flex; border: 1px solid #ddd; background-color: white; min-height: 500px; }
Â  Â  Â  Â  .student-list-valutazioni { width: 350px; flex-shrink: 0; border-right: 1px solid #eee; overflow-y: auto; }
Â  Â  Â  Â  .student-row-valutazioni { display: flex; align-items: center; padding: 10px; border-bottom: 1px solid #eee; cursor: pointer; }
Â  Â  Â  Â  .student-row-valutazioni:hover { background-color: #f9f9f9; }
Â  Â  Â  Â  .student-row-valutazioni.selected { background-color: #ffeaea; border-left: 5px solid #d8232a; padding-left: 5px; font-weight: bold; }
Â  Â  Â  Â  .student-row-valutazioni .student-name { flex-grow: 1; }

Â  Â  Â  Â  .evaluations-area { flex-grow: 1; padding: 20px; }
Â  Â  Â  Â  .evaluation-header { font-size: 1.2em; margin-bottom: 20px; border-bottom: 2px solid #ddd; padding-bottom: 10px; font-weight: bold; }

Â  Â  Â  Â  .evaluation-subject-list { display: flex; flex-direction: column; gap: 10px; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .subject-item { background-color: #eee; padding: 15px; border-radius: 4px; cursor: pointer; display: flex; align-items: center; justify-content: space-between; }
Â  Â  Â  Â  .subject-item:hover { background-color: #e0e0e0; }
Â  Â  Â  Â  .subject-item.selected { background-color: #d8232a; color: white; font-weight: bold; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .subject-info { display: flex; flex-direction: column; text-align: left; }
Â  Â  Â  Â  .subject-media { font-size: 1.2em; font-weight: bold; color: #d8232a; background-color: white; padding: 5px 10px; border-radius: 4px; min-width: 40px; text-align: center; }
Â  Â  Â  Â  .subject-item.selected .subject-media { color: #d8232a; } /* Inverti i colori se selezionato */

Â  Â  Â  Â  .grade-row { display: flex; align-items: center; padding: 10px 0; border-bottom: 1px dashed #eee; font-size: 0.9em; }
Â  Â  Â  Â  .grade-row div { padding: 0 10px; }
Â  Â  Â  Â  .grade-date { width: 150px; color: #777; }
Â  Â  Â  Â  .grade-value { font-weight: bold; color: #d8232a; width: 50px; text-align: center; }
Â  Â  Â  Â  .grade-type { width: 100px; }
Â  Â  Â  Â  .grade-description { flex-grow: 1; }
Â  Â  Â  Â  .grade-row:last-child { border-bottom: none; }

Â  Â  Â  Â  /* Stili per la materia selezionata (tipo la barra di Educazione Civica) */
Â  Â  Â  Â  .materia-selezionata-bar { background-color: #2e2e2e; color: white; padding: 15px 20px; margin-bottom: 20px; font-size: 1.1em; border-radius: 4px; display: flex; justify-content: space-between; align-items: center; }
Â  Â  Â  Â  .materia-selezionata-bar .media-bar { font-size: 1.5em; font-weight: bold; margin-left: 20px; color: #ffcc00; }

Â  Â  </style>
</head>
<body>

Â  Â  <div class="header">
Â  Â  Â  Â  <a href="registro_classe.html" class="header-title">CLASSEVIVA</a>Â 
Â  Â  Â  Â  <span class="header-center">Valutazioni</span>
Â  Â  Â  Â  <div class="user-icon">ðŸ‘¤</div>
Â  Â  </div>
Â  Â Â 
Â  Â  <div class="last-access-bar">
Â  Â  Â  Â  Ultimo accesso: 02-12 ora 16:51 (Simulazione)
Â  Â  </div>

Â  Â  <div class="menu-nav-container">
Â  Â  Â  Â  <div class="menu-nav">
Â  Â  Â  Â  Â  Â  <a href="registro_classe.html" class="icon-item"><div class="i-appello"></div>Appello</a>
Â  Â  Â  Â  Â  Â  <a href="registro_classe.html" class="icon-item"><div class="i-comunicazioni"></div>Comunicazioni</a>
Â  Â  Â  Â  Â  Â  <a href="registro_classe.html" class="icon-item"><div class="i-agenda"></div>Agenda di oggi</a>
Â  Â  Â  Â  Â  Â  <a href="registro_classe.html" class="icon-item"><div class="i-firma"></div>Firma</a>
Â  Â  Â  Â  Â  Â  <a href="registro_classe.html" class="icon-item"><div class="i-comprensenza"></div>Comprensenza</a>
Â  Â  Â  Â  Â  Â  <a href="registro_classe.html" class="icon-item"><div class="i-assenze"></div>Assenze</a>
Â  Â  Â  Â  Â  Â  <a href="registro_classe.html" class="icon-item"><div class="i-registro"></div>Registro</a>
Â  Â  Â  Â  Â  Â  <a href="valutazioni.html" class="icon-item icon-active"><div class="i-valutazioni"></div>Valutazioni</a>Â 
Â  Â  Â  Â  Â  Â  <a href="registro_classe.html" class="icon-item"><div class="i-agenda-prof"></div>Agenda</a>
Â  Â  Â  Â  Â  Â  <a href="registro_classe.html" class="icon-item"><div class="i-didattica"></div>Didattica</a>
Â  Â  Â  Â  Â  Â  <a href="registro_classe.html" class="icon-item" id="classi-link"><div class="i-classi"></div>Le mie classi</a>
Â  Â  Â  Â  Â  Â  <a href="registro_classe.html" class="icon-item"><div class="i-tutti"></div>Tutti i gruppi</a>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div class="content">
Â  Â  Â  Â  <div class="main-info">
Â  Â  Â  Â  Â  Â  Valutazioni della classe <strong id="class-detail">1A</strong>
Â  Â  Â  Â  </div>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <div class="class-links" style="text-align: center; margin-bottom: 15px;">
Â  Â  Â  Â  Â  Â  <a href="#" data-class="1A">1A</a>
Â  Â  Â  Â  Â  Â  <a href="#" data-class="2A">2A</a>
Â  Â  Â  Â  Â  Â  <a href="#" data-class="3A">3A</a>
Â  Â  Â  Â  Â  Â  <a href="#" data-class="4A">4A</a>
Â  Â  Â  Â  Â  Â  <a href="#" data-class="5A">5A</a>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="valutazioni-container">
Â  Â  Â  Â  Â  Â  <div class="student-list-valutazioni">
Â  Â  Â  Â  Â  Â  Â  Â  <div style="padding: 10px; font-weight: bold; font-size: 0.9em; border-bottom: 1px solid #ccc; background-color: #f0f0f0;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Elenco Alunni
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="student-names-list">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="evaluations-area">
Â  Â  Â  Â  Â  Â  Â  Â  <div id="materia-selezionata-container">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <div id="student-name-header" class="evaluation-header">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Seleziona un alunno e una materia
Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div id="evaluations-list">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div id="subject-list" class="evaluation-subject-list">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â Â 
Â  Â  </div>

Â  Â  <script>
Â  Â  Â  Â  // --- CHIAVI PER IL SALVATAGGIO LOCALE (LOCALSTORAGE) ---
Â  Â  Â  Â  const CURRENT_CLASS_KEY = 'cv_current_class';Â 
Â  Â  Â  Â  const CURRENT_STUDENT_ID_KEY = 'cv_current_student_id';
Â  Â  Â  Â  const EVALUATION_DATA_KEY = 'cv_evaluation_data'; // Nuova chiave per salvare i voti

Â  Â  Â  Â  // Dati degli alunni (Copiati dal tuo file registro_classe.html)
Â  Â  Â  Â  const studentData = {
Â  Â  Â  Â  Â  Â  '1A': [
Â  Â  Â  Â  Â  Â  Â  Â  { id: 1, name: 'STELLINA DEMATTEIS', date: '01-01-2007' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 2, name: 'PANDINO DEMATTEIS', date: '02-01-2007' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 3, name: 'TARTARUGA BENUA', date: '03-01-2007' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 4, name: 'YUCKY BENUA', date: '04-01-2007' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 5, name: 'LOLLO BENUA', date: '05-01-2007' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 6, name: 'BRICIOLA DEMATTEIS', date: '06-01-2007' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 7, name: 'FLUFFY DEMATTEIS', date: '07-01-2007' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 8, name: 'TINA DEMATTEIS', date: '08-01-2007' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 9, name: 'GRIGETTA BENUA', date: '09-01-2007' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 10, name: 'LUNA DEMATTEIS', date: '10-01-2007' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 11, name: 'LUNA BENUA', date: '11-01-2007' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 12, name: 'KENDY DEMATTEIS', date: '12-01-2007' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 13, name: 'PAPERO DEMATTEIS', date: '13-01-2007' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 14, name: 'ATTIGLIO DEMATTEIS', date: '14-01-2007' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 15, name: 'SUNNY BENUA', date: '15-01-2007' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 16, name: 'CURT DEMATTEIS', date: '16-01-2007' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 17, name: 'BUNNY BENUA', date: '17-01-2007' }
Â  Â  Â  Â  Â  Â  ],
Â  Â  Â  Â  Â  Â  '2A': [
Â  Â  Â  Â  Â  Â  Â  Â  { id: 18, name: 'CANE DEMATTEIS', date: '01-02-2006' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 19, name: 'CANE BENUA', date: '02-02-2006' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 20, name: 'MICIAN DEMATTEIS', date: '03-02-2006' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 21, name: 'CICCIOBELLO TEMPERINI', date: '04-02-2006' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 22, name: 'MAICOL CAROTINI', date: '05-02-2006' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 23, name: 'CATTIVO TEMPERINI', date: '06-02-2006' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 24, name: 'BAMBOLA CAROTINI', date: '07-02-2006' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 25, name: 'ROBOTTINA ROSSETTI', date: '08-02-2006' }
Â  Â  Â  Â  Â  Â  ],
Â  Â  Â  Â  Â  Â  '3A': [
Â  Â  Â  Â  Â  Â  Â  Â  { id: 26, name: 'ALPHA SCARLETTI', date: '01-03-2005' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 27, name: 'BRAVO BIANCHI', date: '02-03-2005' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 28, name: 'CHARLIE NERI', date: '03-03-2005' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 29, name: 'DELTA ROSSI', date: '04-03-2005' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 30, name: 'ECHO VERDI', date: '05-03-2005' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 31, name: 'FOXTROT GIALLI', date: '06-03-2005' }
Â  Â  Â  Â  Â  Â  ],
Â  Â  Â  Â  Â  Â  '4A': [
Â  Â  Â  Â  Â  Â  Â  Â  { id: 32, name: 'GOLF GRIGI', date: '01-04-2004' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 33, name: 'HOTEL VIOLA', date: '02-04-2004' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 34, name: 'INDIA BLU', date: '03-04-2004' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 35, name: 'JULIET MARRONI', date: '04-04-2004' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 36, name: 'KILO ARANCIO', date: '05-04-2004' }
Â  Â  Â  Â  Â  Â  ],
Â  Â  Â  Â  Â  Â  '5A': [
Â  Â  Â  Â  Â  Â  Â  Â  { id: 37, name: 'LIMA ROSA', date: '01-05-2003' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 38, name: 'MIKE AZZURRO', date: '02-05-2003' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 39, name: 'NOVEMBER BEIGE', date: '03-05-2003' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 40, name: 'OSCAR CREMA', date: '04-05-2003' }
Â  Â  Â  Â  Â  Â  ]
Â  Â  Â  Â  };

Â  Â  Â  Â  // Dati di valutazione di default (vuoti), saranno sovrascritti dai dati salvati
Â  Â  Â  Â  let evaluationData = {
Â  Â  Â  Â  Â  Â  1: {},Â 
Â  Â  Â  Â  Â  Â  2: {}
Â  Â  Â  Â  };

Â  Â  Â  Â  // MATERIE E NOMI DEGLI INSEGNANTI NELL'ORDINE ESATTO RICHIESTO
Â  Â  Â  Â  const allSubjects = [
Â  Â  Â  Â  Â  Â  'Storia (Pomodoro Pikky)',
Â  Â  Â  Â  Â  Â  'Geografia (Pomodoro Pikky, Russa Insalata)',Â 
Â  Â  Â  Â  Â  Â  'Arte (Ananas Pippy)',
Â  Â  Â  Â  Â  Â  'Matematica (Dematteis Alessia)',
Â  Â  Â  Â  Â  Â  'Italiano (Dematteis Alessia)',
            // Condotta e Educazione Civica aggiunte qui!
            'Condotta (Tutti i Docenti)',
            'Educazione Civica (Tutti i Docenti)',
            // Fine nuove voci
Â  Â  Â  Â  Â  Â  'Recupero e Approfondimento (Dematteis Enrico)',
Â  Â  Â  Â  Â  Â  'Sicurezza (Dematteis Enrico)',
Â  Â  Â  Â  Â  Â  'Accoglienza e Orientamento (Dematteis Enrico)',
Â  Â  Â  Â  Â  Â  'Informatica (Ferrari Ferdinando Francesco)',
Â  Â  Â  Â  Â  Â  'Disegno (Ferrari Ferdinando Francesco)',
Â  Â  Â  Â  Â  Â  'Musica (Pomodoro Pikky)',
Â  Â  Â  Â  Â  Â  'Scienze (Ferrari Ferdinando Francesco)',
Â  Â  Â  Â  Â  Â  'Ginnastica (Spinaci Verdi )'
Â  Â  Â  Â  ];

Â  Â  Â  Â  // Variabili globali
Â  Â  Â  Â  let classKey = localStorage.getItem(CURRENT_CLASS_KEY) || '1A';Â 
Â  Â  Â  Â  let currentStudentId = parseInt(localStorage.getItem(CURRENT_STUDENT_ID_KEY)) || 1;Â 
Â  Â  Â  Â  let currentSubject = null;Â 
Â  Â  Â  Â Â 
Â  Â  Â  Â  // --- GESTIONE DATI PERSISTENTI ---
Â  Â  Â  Â Â 
Â  Â  Â  Â  function loadEvaluationData() {
Â  Â  Â  Â  Â  Â  const savedData = localStorage.getItem(EVALUATION_DATA_KEY);
Â  Â  Â  Â  Â  Â  if (savedData) {
Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Sovrascrive l'oggetto vuoto di default con i dati salvati
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  evaluationData = JSON.parse(savedData);
Â  Â  Â  Â  Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error("Errore nel parsing dei dati di valutazione salvati:", e);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // In caso di errore, si mantiene l'oggetto vuoto
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  evaluationData = { 1: {}, 2: {} };
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  function saveEvaluationData() {
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  // Salva l'intero oggetto di valutazione nel localStorage
Â  Â  Â  Â  Â  Â  Â  Â  localStorage.setItem(EVALUATION_DATA_KEY, JSON.stringify(evaluationData));
Â  Â  Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("Errore nel salvataggio dei dati di valutazione:", e);
Â  Â  Â  Â  Â  Â  Â  Â  alert("Attenzione: impossibile salvare i voti nel browser.");
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- FUNZIONE DI UTILITY: CALCOLO MEDIA ---
Â  Â  Â  Â  function calculateAverage(grades) {
Â  Â  Â  Â  Â  Â  if (!grades || grades.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  return { display: '--', numeric: NaN };
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  let sum = 0;
Â  Â  Â  Â  Â  Â  let count = 0;
Â  Â  Â  Â  Â  Â  let textGrades = [];

Â  Â  Â  Â  Â  Â  grades.forEach(g => {
Â  Â  Â  Â  Â  Â  Â  Â  const gradeValue = String(g.grade).replace(',', '.'); // Sostituisci la virgola con il punto
Â  Â  Â  Â  Â  Â  Â  Â  const numericGrade = parseFloat(gradeValue);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (!isNaN(numericGrade)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sum += numericGrade;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  count++;
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  textGrades.push(g.grade);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  if (count > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  const average = sum / count;
Â  Â  Â  Â  Â  Â  Â  Â  // Formatta a 2 decimali solo se non Ã¨ un intero
Â  Â  Â  Â  Â  Â  Â  Â  const display = (average % 1 === 0) ? average.toFixed(0) : average.toFixed(2);
Â  Â  Â  Â  Â  Â  Â  Â  return { display: display, numeric: average };
Â  Â  Â  Â  Â  Â  } else if (textGrades.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  // Se ci sono solo voti testuali, ritorna il conteggio
Â  Â  Â  Â  Â  Â  Â  Â  return { display: `(${textGrades.length})`, numeric: NaN };
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  return { display: '--', numeric: NaN };
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }


Â  Â  Â  Â  // --- GESTIONE CLASSE ---
Â  Â  Â  Â  function getClasseFromStorageOrUrl() {
Â  Â  Â  Â  Â  Â  let selectedClass = localStorage.getItem(CURRENT_CLASS_KEY) || '1A';
Â  Â  Â  Â  Â  Â  if (!studentData[selectedClass]) {
Â  Â  Â  Â  Â  Â  Â  Â  selectedClass = '1A';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  classKey = selectedClass;
Â  Â  Â  Â  Â  Â  localStorage.setItem(CURRENT_CLASS_KEY, classKey);
Â  Â  Â  Â  Â  Â  document.getElementById('class-detail').textContent = classKey;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Aggiorna lo stato attivo nei link
Â  Â  Â  Â  Â  Â  document.querySelectorAll('.class-links a').forEach(link => {
Â  Â  Â  Â  Â  Â  Â  Â  link.classList.remove('active-class');
Â  Â  Â  Â  Â  Â  Â  Â  if (link.getAttribute('data-class') === classKey) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  link.classList.add('active-class');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Listener per i link delle classi
Â  Â  Â  Â  document.querySelectorAll('.class-links a').forEach(link => {
Â  Â  Â  Â  Â  Â  link.addEventListener('click', function(e) {
Â  Â  Â  Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  Â  Â  Â  classKey = this.getAttribute('data-class');
Â  Â  Â  Â  Â  Â  Â  Â  localStorage.setItem(CURRENT_CLASS_KEY, classKey);
Â  Â  Â  Â  Â  Â  Â  Â  // Tenta di selezionare il primo studente della nuova classe
Â  Â  Â  Â  Â  Â  Â  Â  currentStudentId = studentData[classKey][0] ? studentData[classKey][0].id : null;Â 
Â  Â  Â  Â  Â  Â  Â  Â  currentSubject = null; // Resetta la materia
Â  Â  Â  Â  Â  Â  Â  Â  localStorage.setItem(CURRENT_STUDENT_ID_KEY, currentStudentId);
Â  Â  Â  Â  Â  Â  Â  Â  initValutazioni(); // Ricarica tutto per la nuova classe
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  });

Â  Â  Â  Â  // --- RENDER ALUNNI ---
Â  Â  Â  Â  function renderStudentList() {
Â  Â  Â  Â  Â  Â  const studentListContainer = document.getElementById('student-names-list');
Â  Â  Â  Â  Â  Â  studentListContainer.innerHTML = '';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const students = studentData[classKey];
Â  Â  Â  Â  Â  Â  let studentHtml = '';

Â  Â  Â  Â  Â  Â  students.forEach(student => {
Â  Â  Â  Â  Â  Â  Â  Â  const isSelected = student.id === currentStudentId ? 'selected' : '';
Â  Â  Â  Â  Â  Â  Â  Â  studentHtml += `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="student-row-valutazioni ${isSelected}" data-student-id="${student.id}" onclick="selectStudent(${student.id}, '${student.name}')">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="student-name">${student.name}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="font-size: 0.7em; color: #aaa;">(${student.date})</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  studentListContainer.innerHTML = studentHtml;
Â  Â  Â  Â  }

Â  Â  Â  Â  function selectStudent(studentId, studentName) {
Â  Â  Â  Â  Â  Â  currentStudentId = studentId;
Â  Â  Â  Â  Â  Â  localStorage.setItem(CURRENT_STUDENT_ID_KEY, studentId);
Â  Â  Â  Â  Â  Â  document.getElementById('student-name-header').innerHTML = studentName;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  currentSubject = null;Â 
Â  Â  Â  Â  Â  Â  renderStudentList();Â 
Â  Â  Â  Â  Â  Â  renderSubjectList();
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  // --- RENDER MATERIE AGGIORNATO CON MEDIA ---

Â  Â  Â  Â  function renderSubjectList() {
Â  Â  Â  Â  Â  Â  const subjectListContainer = document.getElementById('subject-list');
Â  Â  Â  Â  Â  Â  const studentHeader = document.getElementById('student-name-header');
Â  Â  Â  Â  Â  Â  const evaluationsList = document.getElementById('evaluations-list');
Â  Â  Â  Â  Â  Â  const materiaBar = document.getElementById('materia-selezionata-container');

Â  Â  Â  Â  Â  Â  subjectListContainer.innerHTML = '';
Â  Â  Â  Â  Â  Â  evaluationsList.innerHTML = '';
Â  Â  Â  Â  Â  Â  materiaBar.innerHTML = '';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (currentStudentId === null) {
Â  Â  Â  Â  Â  Â  Â  Â  studentHeader.innerHTML = 'Seleziona un alunno per visualizzare le materie.';
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  const studentName = studentData[classKey].find(s => s.id === currentStudentId).name;
Â  Â  Â  Â  Â  Â  studentHeader.innerHTML = `Materie di **${studentName}**`;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Assicurati che lo studente abbia un entry in evaluationData (se non caricata da storage)
Â  Â  Â  Â  Â  Â  const studentEvaluations = evaluationData[currentStudentId] || {};


Â  Â  Â  Â  Â  Â  allSubjects.forEach(fullSubjectName => {
Â  Â  Â  Â  Â  Â  Â  Â  let displaySubject = fullSubjectName;
Â  Â  Â  Â  Â  Â  Â  Â  let dataSubjectValue = fullSubjectName;Â 
Â  Â  Â  Â  Â  Â  Â  Â  let teacherInfo = '';
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Estrazione del nome base e del docente
Â  Â  Â  Â  Â  Â  Â  Â  const startParen = fullSubjectName.indexOf('(');
Â  Â  Â  Â  Â  Â  Â  Â  const endParen = fullSubjectName.indexOf(')');

Â  Â  Â  Â  Â  Â  Â  Â  if (startParen > 0 && endParen > startParen) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  teacherInfo = fullSubjectName.substring(startParen + 1, endParen);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dataSubjectValue = fullSubjectName.substring(0, startParen).trim();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  displaySubject = dataSubjectValue;
Â  Â  Â  Â  Â  Â  Â  Â  } else if (fullSubjectName.includes('Condotta') || fullSubjectName.includes('Educazione Civica')) {
                    // Condotta e Educazione Civica potrebbero non avere un docente specifico nel nome
                    dataSubjectValue = fullSubjectName.split(' (')[0].trim();
                    displaySubject = dataSubjectValue;
                }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Calcolo della media
Â  Â  Â  Â  Â  Â  Â  Â  const subjectGrades = studentEvaluations[dataSubjectValue] || [];
Â  Â  Â  Â  Â  Â  Â  Â  const average = calculateAverage(subjectGrades);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Colore della media (es. rosso se sotto 6)
Â  Â  Â  Â  Â  Â  Â  Â  let avgColor = average.numeric < 6 ? '#d8232a' : (average.numeric >= 7.5 ? '#008000' : '#2e2e2e');
Â  Â  Â  Â  Â  Â  Â  Â  if (isNaN(average.numeric) && average.display !== '--') avgColor = '#555'; // Voti testuali
Â  Â  Â  Â  Â  Â  Â  Â  if (average.display === '--') avgColor = '#999'; // Nessun voto

Â  Â  Â  Â  Â  Â  Â  Â  // HTML per la lista
Â  Â  Â  Â  Â  Â  Â  Â  const subjectHtml = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="subject-item" data-subject="${dataSubjectValue}" onclick="renderEvaluationDetails('${dataSubjectValue}')">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="subject-info">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>${displaySubject}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${teacherInfo ? `<span style="font-size: 0.75em; color: #555; margin-top: 3px;">(${teacherInfo})</span>` : ''}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="subject-media" style="color: white; background-color: ${avgColor};">${average.display}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  subjectListContainer.innerHTML += subjectHtml;
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function renderEvaluationDetails(subject) {
Â  Â  Â  Â  Â  Â  currentSubject = subject;

Â  Â  Â  Â  Â  Â  const studentHeader = document.getElementById('student-name-header');
Â  Â  Â  Â  Â  Â  const evaluationsList = document.getElementById('evaluations-list');
Â  Â  Â  Â  Â  Â  const subjectListContainer = document.getElementById('subject-list');
Â  Â  Â  Â  Â  Â  const materiaBar = document.getElementById('materia-selezionata-container');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const studentName = studentData[classKey].find(s => s.id === currentStudentId).name;
Â  Â  Â  Â  Â  Â  studentHeader.innerHTML = studentName;Â 
Â  Â  Â  Â  Â  Â  subjectListContainer.innerHTML = ''; // Nasconde la lista delle materie

Â  Â  Â  Â  Â  Â  const studentEvaluations = evaluationData[currentStudentId] || {};
Â  Â  Â  Â  Â  Â  const subjectGrades = studentEvaluations[subject] || [];
Â  Â  Â  Â  Â  Â  const average = calculateAverage(subjectGrades);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Trova la stringa completa originale (con insegnanti) per il display della barra
Â  Â  Â  Â  Â  Â  const originalSubjectEntry = allSubjects.find(s => s.startsWith(subject + ' (') || s === subject) || subject;
Â  Â  Â  Â  Â  Â  let fullSubjectDisplay = originalSubjectEntry.toUpperCase();

Â  Â  Â  Â  Â  Â  // Aggiorna la barra della materia CON IL PULSANTE + e la MEDIA
Â  Â  Â  Â  Â  Â  materiaBar.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  <div class="materia-selezionata-bar">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="display: flex; align-items: center;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span onclick="renderSubjectList()" style="cursor: pointer;">&lt; ${fullSubjectDisplay}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="media-bar">${average.display}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="toggleGradeInput()" style="background: white; color: #d8232a; border: none; padding: 5px 10px; border-radius: 4px; font-weight: bold; cursor: pointer; font-size: 1.2em;">+</button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // --- Area di Input Voto (Nascosta inizialmente) ---
Â  Â  Â  Â  Â  Â  let inputAreaHtml = `
Â  Â  Â  Â  Â  Â  Â  Â  <div id="grade-input-area" style="display: none; padding: 15px; border: 1px solid #d8232a; margin-bottom: 20px; border-radius: 4px; background-color: #ffeaea;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4 style="margin-top: 0;">Inserisci Nuovo Voto per ${subject}:</h4>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="date" id="input-date" value="${new Date().toISOString().slice(0, 10)}" style="padding: 5px; margin-right: 10px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="input-grade" placeholder="Voto (es. 7, 6.5, Ottimo)" style="padding: 5px; width: 150px; margin-right: 10px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="input-type" style="padding: 5px; margin-right: 10px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="Verifica">Verifica</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="Interrogazione">Interrogazione</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="Esercizi">Esercizi</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="Orale">Orale</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="Scritto">Scritto</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="input-description" placeholder="Descrizione (es. Analisi logica)" style="padding: 5px; width: 250px; margin-right: 10px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="saveNewGrade('${subject}')" style="background-color: #d8232a; color: white; padding: 6px 15px; border: none; border-radius: 4px; cursor: pointer;">Salva</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="toggleGradeInput()" style="background-color: #ccc; color: #333; padding: 6px 15px; border: none; border-radius: 4px; cursor: pointer;">Annulla</button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  `;


Â  Â  Â  Â  Â  Â  let gradesHtml = inputAreaHtml; // Iniziamo l'HTML con l'area di input

Â  Â  Â  Â  Â  Â  if (subjectGrades.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  gradesHtml += `<p style="padding: 20px; text-align: center; color: #888;">Nessuna valutazione registrata per ${subject}.</p>`;
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  gradesHtml += `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="grade-row" style="border-bottom: 2px solid #ddd; font-weight: bold;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="grade-date">DATA</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="grade-value">VOTO</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="grade-type">TIPO</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="grade-description">DESCRIZIONE</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Ordiniamo i voti per data (dal piÃ¹ recente al meno recente)
Â  Â  Â  Â  Â  Â  Â  Â  subjectGrades.sort((a, b) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Converti le date 'DD/MM/YYYY' in oggetti Date
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const datePartsA = a.date.split('/');
                    const dateA = new Date(datePartsA[2], datePartsA[1] - 1, datePartsA[0]);
                    
                    const datePartsB = b.date.split('/');
                    const dateB = new Date(datePartsB[2], datePartsB[1] - 1, datePartsB[0]);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return dateB - dateA; // Ordine decrescente
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  subjectGrades.forEach(grade => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  gradesHtml += `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="grade-row">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="grade-date">${grade.date}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="grade-value">${grade.grade}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="grade-type">${grade.type}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="grade-description">${grade.description}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  }


Â  Â  Â  Â  Â  Â  evaluationsList.innerHTML = gradesHtml;
Â  Â  Â  Â  }


Â  Â  Â  Â  // --- FUNZIONI PER L'INSERIMENTO VOTO ---
Â  Â  Â  Â Â 
Â  Â  Â  Â  function toggleGradeInput() {
Â  Â  Â  Â  Â  Â  const inputArea = document.getElementById('grade-input-area');
Â  Â  Â  Â  Â  Â  if (inputArea) {
Â  Â  Â  Â  Â  Â  Â  Â  inputArea.style.display = inputArea.style.display === 'none' ? 'block' : 'none';
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (inputArea.style.display === 'block') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('input-grade').value = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('input-description').value = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('input-date').value = new Date().toISOString().slice(0, 10);Â 
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  function saveNewGrade(subject) {
Â  Â  Â  Â  Â  Â  const dateInput = document.getElementById('input-date').value;
Â  Â  Â  Â  Â  Â  const grade = document.getElementById('input-grade').value.trim();
Â  Â  Â  Â  Â  Â  const type = document.getElementById('input-type').value;
Â  Â  Â  Â  Â  Â  const description = document.getElementById('input-description').value.trim();

Â  Â  Â  Â  Â  Â  if (!grade || !dateInput) {
Â  Â  Â  Â  Â  Â  Â  Â  alert('Inserisci un voto e una data validi.');
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // Formattiamo la data da YYYY-MM-DD a DD/MM/YYYY
Â  Â  Â  Â  Â  Â  const parts = dateInput.split('-');
Â  Â  Â  Â  Â  Â  const formattedDate = `${parts[2]}/${parts[1]}/${parts[0]}`;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const newGrade = {
Â  Â  Â  Â  Â  Â  Â  Â  date: formattedDate,
Â  Â  Â  Â  Â  Â  Â  Â  grade: grade,
Â  Â  Â  Â  Â  Â  Â  Â  type: type,
Â  Â  Â  Â  Â  Â  Â  Â  description: description || 'Nessuna descrizione'Â 
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // 1. Inizializza l'alunno se non ha voti
Â  Â  Â  Â  Â  Â  if (!evaluationData[currentStudentId]) {
Â  Â  Â  Â  Â  Â  Â  Â  evaluationData[currentStudentId] = {};
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // 2. Inizializza la materia per l'alunno se non esiste
Â  Â  Â  Â  Â  Â  if (!evaluationData[currentStudentId][subject]) {
Â  Â  Â  Â  Â  Â  Â  Â  evaluationData[currentStudentId][subject] = [];
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // 3. Aggiungi il nuovo voto
Â  Â  Â  Â  Â  Â  evaluationData[currentStudentId][subject].push(newGrade);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // CHIAMATA FONDAMENTALE: SALVA I DATI AGGIORNATI NEL LOCALSTORAGE
Â  Â  Â  Â  Â  Â  saveEvaluationData();
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // 4. Ricarica la visualizzazione per mostrare il nuovo voto
Â  Â  Â  Â  Â  Â  renderEvaluationDetails(subject);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  alert(`Voto '${grade}' salvato con successo per ${subject} e salvato localmente!`);
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  // --- FUNZIONE DI INIZIALIZZAZIONE ---
Â  Â  Â  Â  function initValutazioni() {
Â  Â  Â  Â  Â  Â  // 1. Carica i voti salvati
Â  Â  Â  Â  Â  Â  loadEvaluationData();
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // 2. Carica la classe e lo studente selezionati
Â  Â  Â  Â  Â  Â  getClasseFromStorageOrUrl();
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Assicurati che uno studente sia selezionato all'inizioÂ 
Â  Â  Â  Â  Â  Â  if (currentStudentId === null) {
Â  Â  Â  Â  Â  Â  Â  Â  currentStudentId = studentData[classKey][0] ? studentData[classKey][0].id : null;
Â  Â  Â  Â  Â  Â  Â  Â  localStorage.setItem(CURRENT_STUDENT_ID_KEY, currentStudentId);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  renderStudentList();Â 

Â  Â  Â  Â  Â  Â  if (currentStudentId) {
Â  Â  Â  Â  Â  Â  Â  Â  renderSubjectList();Â 
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('student-name-header').innerHTML = 'Nessun alunno disponibile in questa classe.';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Inizializza al caricamento
Â  Â  Â  Â  window.onload = initValutazioni;
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Espone le funzioni al window per gli onclick
Â  Â  Â  Â  window.selectStudent = selectStudent;
Â  Â  Â  Â  window.renderEvaluationDetails = renderEvaluationDetails;
Â  Â  Â  Â  window.renderSubjectList = renderSubjectList;
Â  Â  Â  Â  window.toggleGradeInput = toggleGradeInput;
Â  Â  Â  Â  window.saveNewGrade = saveNewGrade;
Â  Â  Â  Â  window.loadEvaluationData = loadEvaluationData; // Esposta solo per chiarezza, non necessaria per onclick

Â  Â  </script>
</body>

</html>
