<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CLASSEVIVA - Registro di classe</title>
    <style>
        /* RESET E VARIABILI */
        body { font-family: 'Open Sans', Arial, sans-serif; margin: 0; padding: 0; background-color: #f7f7f7; color: #333; }
        :root {
            --cv-red: #d8232a;
            --cv-yellow: #ffcc00;
            --cv-dark-red: #a01a20;
            --cv-gray: #e9ecef;
            --cv-green: #28a745;
            --cv-light-red: #ffcccc;
            --row-height: 40px; /* Altezza uniforme per tutte le righe dei dati */
        }

        /* INTESTAZIONE CLASSEVIVA */
        .header-top { background-color: var(--cv-red); color: white; padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .header-title { font-size: 1.5em; font-weight: bold; }
        .header-center { font-size: 1.1em; font-weight: 300; }
        .user-icon { background-color: rgba(255, 255, 255, 0.2); padding: 5px 10px; border-radius: 4px; font-weight: bold; cursor: pointer; }
        
        .header-info { background-color: var(--cv-yellow); color: #333; padding: 5px 20px; font-size: 0.9em; }

        /* NAVIGAZIONE ICONE RAPIDE */
        .quick-links { text-align: center; padding: 15px 0; border-bottom: 1px solid #ddd; background-color: white; }
        .quick-link { display: inline-block; margin: 0 15px; text-decoration: none; color: #555; font-size: 0.8em; }
        .quick-link span { display: block; font-size: 24px; margin-bottom: 5px; }
        .quick-link.active { border-bottom: 2px solid var(--cv-red); color: var(--cv-red); font-weight: bold; }

        /* CONTENUTO PRINCIPALE (Registro e Controlli) */
        .container {
            padding: 10px 20px;
            max-width: 1500px;
            margin: 0 auto;
            display: flex;
            gap: 20px;
        }

        .registro-wrapper {
            flex-grow: 1;
            background-color: white;
            border: 1px solid #ccc;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            min-width: 0;
        }

        /* BARRA DI CONTROLLO SUPERIORE */
        .class-header {
            text-align: center;
            padding: 15px;
            border-bottom: 1px solid #ddd;
            background-color: #fcfcfc;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        /* FILTRI E PULSANTI */
        .filters {
            padding: 15px;
            border-bottom: 1px solid #ddd;
            font-size: 0.9em;
            background-color: white;
            position: sticky;
            top: 60px; /* Sotto l'header di classe */
            z-index: 90;
        }
        
        /* STRUTTURA PRINCIPALE (Alunni + Registro) */
        .main-grid {
            display: flex;
            position: relative;
        }
        
        /* COLONNA ALUNNI */
        .alunni-col {
            width: 300px;
            border-right: 1px solid #ccc;
            overflow-y: scroll;
            flex-shrink: 0;
            background-color: #fcfcfc;
            /* Calcola altezza in base agli altri elementi fissi */
            max-height: calc(100vh - 200px); 
        }
        
        /* Contenitore per allineare l'header alunni con l'header della tabella */
        .alunni-fixed-header-container {
            position: sticky;
            top: 0;
            z-index: 30; /* Deve stare sopra l'header del registro */
            background-color: white;
            border-bottom: 1px solid #ccc;
        }
        .alunni-header {
            padding: 10px;
            font-weight: bold;
            background-color: var(--cv-gray);
            border-bottom: 1px solid #ccc;
            height: var(--row-height); 
            line-height: calc(var(--row-height) - 20px); 
            display: flex;
            align-items: center;
            padding: 0 10px;
        }
        
        /* Riga Lezioni Fissa */
        .lezioni-row-alunni {
            height: var(--row-height); 
            background-color: #f8f8f8;
            border-bottom: 1px solid #ccc;
            display: flex;
            align-items: center;
            padding: 0 10px;
        }

        .alunno-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 10px;
            border-bottom: 1px solid #e0e0e0;
            font-size: 0.9em;
            height: var(--row-height);
            box-sizing: border-box;
        }
        
        /* TABELLA REGISTRO */
        .registro-col {
            flex-grow: 1;
            overflow: auto;
        }
        .registro-table {
            width: 100%;
            border-collapse: collapse;
            position: relative; /* Base per gli sticky */
        }
        
        /* Intestazione delle Ore (1 ora, 2 ora, ecc.) - Fissa */
        .registro-table thead tr th {
            position: sticky;
            top: 0; 
            z-index: 20;
            background-color: var(--cv-gray);
            color: var(--cv-dark-red);
            font-size: 0.85em;
            font-weight: bold;
            border: 1px solid #ccc;
            height: var(--row-height);
            line-height: var(--row-height);
            padding: 0 8px;
        }
        
        /* Riga "Lezioni" subito sotto l'header delle ore - Fissa */
        #row-lezioni {
            position: sticky;
            top: var(--row-height); /* Sotto l'header delle ore (40px) */
            z-index: 15;
            background-color: white;
        }

        /* Fissa la colonna "Giornale del professore" (prima colonna) */
        .registro-table th:first-child, 
        .registro-table td:first-child {
            position: sticky;
            left: 0;
            z-index: 25; /* Pi√π alto per coprire lo scroll orizzontale */
            background-color: var(--cv-gray);
            border-right: 1px solid #ccc;
        }
        #row-lezioni td:first-child {
            z-index: 17; /* Sotto l'angolo fisso */
            background-color: #f8f8f8;
            font-weight: bold;
        }


        .registro-table td {
            border: 1px solid #ccc;
            padding: 0;
            min-width: 100px;
            text-align: center;
            height: var(--row-height);
            box-sizing: border-box;
        }
        
        /* CELLE APPELLO (P, A) */
        .appello-cell {
            cursor: pointer;
            font-weight: bold;
            font-size: 1.1em;
            line-height: var(--row-height); 
        }
        .appello-cell.presente { background-color: #e6ffe6; color: var(--cv-green); }
        .appello-cell.assente { background-color: var(--cv-light-red); color: var(--cv-red); }
        
    </style>
</head>
<body>

    <div class="header-top">
        <span class="header-title">CLASSEVIVA</span>
        <span class="header-center">Registro di classe</span>
        <div class="user-icon">üë§</div>
    </div>
    
    <div class="header-info">Ultimo accesso: 03/12 ore 16:00 (Simulazione)</div>

    <div class="menu-nav">
            <a href="registro_classe.html" class="icon-item icon-active"><div class="i-appello">üìñ</div>Appello</a>
            <a href="comunicazioni.html" class="icon-item"><div class="i-comunicazioni">üì¢</div>Comunicazioni</a>
            <a href="agenda_oggi.html" class="icon-item"><div class="i-agenda">üìÖ</div>Agenda di oggi</a>
            <a href="firma.html" class="icon-item"><div class="i-firma">‚úçÔ∏è</div>Firma</a>
            <a href="compresenza.html" class="icon-item"><div class="i-comprensenza">üë•</div>Comprensenza</a>
            <a href="assenze.html" class="icon-item"><div class="i-assenze">üö´</div>Assenze</a>
            <a href="valutazioni.html" class="icon-item"><div class="i-valutazioni">üíØ</div>Valutazioni</a>
            <a href="agenda.html" class="icon-item"><div class="i-agenda-prof">üóìÔ∏è</div>Agenda</a>
            <a href="didattica.html" class="icon-item"><div class="i-valutazioni">üíØ</div>Didattica</a>
            <a href="mie_classi.html" class="icon-item" id="classi-link"><div class="i-classi">üè´</div>Le mie classi</a>
            <a href="gruppi.html" class="icon-item"><div class="i-tutti">üåê</div>Tutti i gruppi</a>
        </div>

    <div class="container">
        <div class="registro-wrapper">
            <div class="class-header">
                <h2>Registro di classe di <span style="color: var(--cv-red);">1A</span> del giorno</h2>
                <div class="class-selector">
                    <a href="#" class="active">1A</a>
                    <a href="#">2A</a>
                    <a href="#">3A</a>
                </div>
            </div>

            <div class="filters">
                <div style="margin-bottom: 10px;">
                    Filtra per iniziale: <a href="#">B</a> ... <a href="#" style="font-weight: bold;">Tutti</a>
                    <span style="margin-left: 20px;"></span>
                    Seleziona: <a href="#" style="font-weight: bold;">tutti</a> <a href="#">nessuno</a> <a href="#">sottogruppo</a>
                </div>
                <div class="filter-buttons">
                    <button id="btn-tutti-presenti" onclick="setAllPresences('presente')">Appello: Tutti Presenti</button>
                    <button id="btn-tutti-assenti" onclick="setAllPresences('assente')">Appello: Tutti Assenti</button>
                    <button id="btn-cancella-presenze" onclick="setAllPresences('vuoto')">Cancella Tutte le Presenze</button>
                </div>
                <p style="font-size: 0.9em; margin-top: 10px; color: #555;">lezione MARTED√å 02 DICEMBRE 2025</p>
            </div>

            <div class="main-grid">
                
                <div class="alunni-col">
                    <div class="alunni-fixed-header-container">
                        <div class="alunni-header" style="background-color: var(--cv-gray); height: 41px;">
                            Alunni
                        </div>
                        <div class="lezioni-row-alunni">
                            </div>
                    </div>

                    <div id="alunni-list">
                        </div>
                </div>

                <div class="registro-col">
                    <table class="registro-table">
                        <thead>
                            <tr>
                                <th style="min-width: 120px; font-weight: normal; padding: 0 10px; text-align: left;">Giornale del professore</th>
                                <th>1 ora</th>
                                <th>2 ora</th>
                                <th>3 ora</th>
                                <th>4 ora</th>
                                <th>5 ora</th>
                                <th>6 ora</th>
                                <th>7 ora</th>
                            </tr>
                        </thead>
                        <tbody id="registro-body">
                            <tr id="row-lezioni">
                                <td style="text-align: left; padding-left: 10px;">Lezioni</td>
                                <td class="lezione-cell"><button class="lezione-btn lezione-attiva">LEZIONE</button></td>
                                <td class="lezione-cell"><button class="lezione-btn lezione-attiva">LEZIONE</button></td>
                                <td class="lezione-cell"><button class="lezione-btn">LEZIONE</button></td>
                                <td class="lezione-cell"><button class="lezione-btn">LEZIONE</button></td>
                                <td class="lezione-cell"><button class="lezione-btn">LEZIONE</button></td>
                                <td class="lezione-cell"><button class="lezione-btn">LEZIONE</button></td>
                                <td class="lezione-cell"><button class="lezione-btn">LEZIONE</button></td>
                            </tr>
                            </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="sidebar-calendar">
             </div>
    </div>

    <div id="confirmModal" class="modal">
        <div class="modal-content">
            <h2>Conferma Operazione</h2>
            <p>Stai per eseguire un'azione. Vuoi procedere?</p>
            <button class="confirm-btn" onclick="executeAction()">Conferma</button>
            <button class="cancel-btn" onclick="closeModal('confirmModal')">Annulla</button>
        </div>
    </div>

    <script>
        // Dati degli Alunni (estesi come da screenshot)
        const students = [
            { id: 1, name: 'STELLINA DEMATTEIS', dob: '(01-01-2007)' },
            { id: 2, name: 'PANDINO DEMATTEIS', dob: '(02-01-2007)' },
            { id: 3, name: 'TARTARUGA BENUA', dob: '(03-01-2007)' },
            { id: 4, name: 'YUCKY BENUA', dob: '(04-01-2007)' },
            { id: 5, name: 'LOLLO BENUA', dob: '(05-01-2007)' },
            { id: 6, name: 'BRICIOLA DEMATTEIS', dob: '(06-01-2007)' },
            { id: 7, name: 'FLUFFY DEMATTEIS', dob: '(07-01-2007)' },
            { id: 8, name: 'TINA DEMATTEIS', dob: '(08-01-2007)' },
            { id: 9, name: 'GRIGETTA BENUA', dob: '(09-01-2007)' },
            { id: 10, name: 'LUNA DEMATTEIS', dob: '(10-01-2007)' },
            { id: 11, name: 'LUNA BENUA', dob: '(11-01-2007)' },
            { id: 12, name: 'KENDY DEMATTEIS', dob: '(12-01-2007)' },
            { id: 13, name: 'PAPERO DEMATTEIS', dob: '(13-01-2007)' },
            { id: 14, name: 'ATTIGLIO DEMATTEIS', dob: '(14-01-2007)' },
            { id: 15, name: 'SUNNY BENUA', dob: '(15-01-2007)' },
            { id: 16, name: 'CURT DEMATTEIS', dob: '(16-01-2007)' },
            { id: 17, name: 'BUNNY BENUA', dob: '(17-01-2007)' },
        ];
        
        // Stato appello (simulazione: salviamo lo stato nel browser)
        const APPELLO_STORAGE_KEY = 'cv_appello_state';

        let appelloState = JSON.parse(localStorage.getItem(APPELLO_STORAGE_KEY));
        if (!appelloState) {
            appelloState = initializeAppelloState();
            saveAppelloState();
        }

        function initializeAppelloState() {
            const state = {};
            students.forEach(student => {
                state[student.id] = { 
                    1: 'presente', 
                    2: 'presente', 
                    3: 'vuoto', 
                    4: 'vuoto', 
                    5: 'vuoto', 
                    6: 'vuoto', 
                    7: 'vuoto' 
                };
            });
            return state;
        }

        function saveAppelloState() {
            localStorage.setItem(APPELLO_STORAGE_KEY, JSON.stringify(appelloState));
        }

        function getCellStatus(studentId, hour) {
            return appelloState[studentId] ? appelloState[studentId][hour] : 'vuoto';
        }

        // Funzione per generare le righe degli alunni e il registro
        function renderStudentRows() {
            const listContainer = document.getElementById('alunni-list');
            const tableBody = document.getElementById('registro-body');
            
            listContainer.innerHTML = '';
            
            // Rimuove solo le righe degli alunni (tutte tranne la riga "Lezioni")
            const existingRows = tableBody.querySelectorAll('tr:not(#row-lezioni)');
            existingRows.forEach(row => row.remove());

            const alunniListFragment = document.createDocumentFragment();

            students.forEach((student, index) => {
                // 1. Riga Alunno nella Colonna Fissa
                const alunnoDiv = document.createElement('div');
                alunnoDiv.className = 'alunno-row';
                alunnoDiv.id = `alunno-row-${student.id}`; // Aggiunto ID per riferimento
                alunnoDiv.innerHTML = `
                    <span style="width: 20px;">${index + 1}</span>
                    <div style="flex-grow: 1; text-align: left;">
                        <span class="alunno-name">${student.name}</span>
                        <span class="alunno-details">${student.dob}</span>
                    </div>
                    <span class="alunno-menu">...</span>
                `;
                alunniListFragment.appendChild(alunnoDiv);

                // 2. Riga nel Corpo della Tabella Registro
                const registroRow = tableBody.insertRow(-1);
                registroRow.id = `data-row-${student.id}`;
                
                // Cella vuota fissa Giornale del Professore
                registroRow.insertCell(0).style.textAlign = 'left'; 

                // Celle Appello (da 1 a 7 ora)
                for (let h = 1; h <= 7; h++) {
                    const cell = registroRow.insertCell(h);
                    cell.className = 'appello-cell';
                    cell.setAttribute('data-student-id', student.id);
                    cell.setAttribute('data-hour', h);
                    cell.onclick = function() { togglePresence(student.id, h, this); };

                    updateCellAppearance(cell, getCellStatus(student.id, h));
                }
            });

            listContainer.appendChild(alunniListFragment);
        }

        // --- GESTIONE FUNZIONALIT√Ä APPELLO ---

        function updateCellAppearance(cell, status) {
            cell.textContent = '';
            cell.className = 'appello-cell';
            
            if (status === 'presente') {
                cell.classList.add('presente');
                cell.textContent = 'P';
            } else if (status === 'assente') {
                cell.classList.add('assente');
                cell.textContent = 'A';
            }
        }

        function togglePresence(studentId, hour, cellElement) {
            const currentStatus = getCellStatus(studentId, hour);
            let newStatus;
            
            if (currentStatus === 'vuoto') {
                newStatus = 'presente';
            } else if (currentStatus === 'presente') {
                newStatus = 'assente';
            } else {
                newStatus = 'vuoto';
            }

            appelloState[studentId][hour] = newStatus;
            updateCellAppearance(cellElement, newStatus);
            saveAppelloState();
        }

        function setAllPresences(status) {
            const actionText = status === 'presente' ? 'Tutti Presenti' : (status === 'assente' ? 'Tutti Assenti' : 'Cancellazione Presenze');
            if (!confirm(`Sei sicuro di voler impostare l'appello di TUTTI gli alunni su: ${actionText}?`)) {
                return;
            }
            
            students.forEach(student => {
                for (let h = 1; h <= 7; h++) { 
                    appelloState[student.id][h] = status;
                }
            });

            saveAppelloState();
            renderStudentRows();
        }

        // --- GESTIONE MODALE (Centrato) ---

        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'flex'; 
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        function executeAction() {
            alert("Azione confermata!");
            closeModal('confirmModal');
        }

        window.onclick = function(event) {
            const confirmModal = document.getElementById('confirmModal');
            if (event.target == confirmModal) {
                closeModal('confirmModal');
            }
        }

        // --- INIZIALIZZAZIONE ---
        document.addEventListener('DOMContentLoaded', () => {
            renderStudentRows();
        });

        // Espone le funzioni globali
        window.togglePresence = togglePresence;
        window.setAllPresences = setAllPresences;
    </script>
</body>
</html>
